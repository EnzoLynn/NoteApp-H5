"use strict";define(function(require,exports,module){var dbHelper,IndexDBHelper=require("js/IndexDBHelper.js"),storeName="Notes",databaseName="NoteApp";dbHelper=new IndexDBHelper,dbHelper.openDatabase(databaseName,storeName,!1,function(omes){omes.success||alert(omes.msg)}),window.refreshList=function(){getNoteList(window.scope)},mui.plusReady(function(){ReactDOM.render(React.createElement(ListSubPage,null),mui(".subpageContainer")[0])});var NoteRow=React.createClass({displayName:"NoteRow",delNote:function(e,key){e.stopPropagation();var me=this,li=me.refs.muiLi;dbHelper.deleteById(storeName,key,function(dmes){dmes.success?(mui.swipeoutClose(li),me.props.afterdel1()):alert(dmes.msg)})},editNote:function(e,key){e.stopPropagation();dbHelper.getById(storeName,key,function(mes){if(mes.success){var val=mes.result.content;null==val&&(val="");var ws=mui.openWindow({url:"addNoteWindow.html",id:"addNoteWindow",styles:{top:0,bottom:0,width:"100%",height:"100%",hardwareAccelerated:!0},extras:{},createNew:!1,show:{autoShow:!0,aniShow:"slide-in-right",duration:100},waiting:{autoShow:!0,title:"正在加载...",options:{}}});ws&&ws.evalJS("PushValue('"+key+"','"+val+"')")}else alert(mes.msg)})},openShareWindow:function(key){var ws=mui.openWindow({url:"Share.html",id:"Share",styles:{top:0,bottom:0,width:"100%",height:"100%",hardwareAccelerated:!0},extras:{},createNew:!1,show:{autoShow:!0,aniShow:"slide-in-right",duration:1},waiting:{autoShow:!0,title:"正在加载...",options:{}}});ws&&dbHelper.getById(storeName,key,function(mes){if(mes.success){var val=mes.result.content;null==val&&(val=""),ws.evalJS("ShareText('"+val+"')")}else alert(mes.msg)})},render:function(){var _this=this,note=this.props.note;null==note.content&&(note.content="");var deNote=unescape(note.content),val=deNote.length>15?deNote.substring(0,15)+"...":deNote;return React.createElement("li",{ref:"muiLi",className:"mui-table-view-cell listCell"},React.createElement("div",{className:"mui-slider-right mui-disabled "},React.createElement("a",{className:"mui-btn mui-btn-blue",onClick:function(){return _this.openShareWindow(note.id)}},"分享"),React.createElement("a",{className:"mui-btn mui-btn-red",onClick:function(e){return _this.delNote(e,note.id)}},"删除")),React.createElement("div",{className:"mui-slider-handle",onClick:function(e){return _this.editNote(e,note.id)}},React.createElement("a",{className:"mui-navigate-right"},val,React.createElement("p",{"class":"mui-ellipsis"},note.createon))))}});window.getNoteList=function(scope){var me=scope;dbHelper.find(storeName,!1,!1,function(mes){if(mes.success){var notes=mes.result;notes.sort(function(a,b){var kA=a.id,kB=b.id;return kB>kA?1:-1}),me.setState({notes:notes})}else alert(mes.msg)})};var ListSubPage=React.createClass({displayName:"ListSubPage",pulldownRefresh:function(){var me=this;document.body.querySelector(".mui-table-view"),document.body.querySelectorAll(".mui-table-view-cell");me.getList(),mui("#pullrefresh").pullRefresh().endPulldownToRefresh(),mui("#pullrefresh").pullRefresh().refresh(!0)},pullupRefresh:function(){var me=this;dbHelper.find(storeName,!1,!1,function(mes){if(mes.success){var numKeys=mes.result.length,cells=(document.body.querySelector(".mui-table-view"),document.body.querySelectorAll(".mui-table-view-cell"));mui("#pullrefresh").pullRefresh().endPullupToRefresh(cells.length>=numKeys),me.getList()}else alert(mes.msg)})},getList:function(){var me=this;window.getNoteList(me)},componentDidMount:function(){var me=this;window.scope=me,mui.init({pullRefresh:{container:"#pullrefresh",down:{contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新...",callback:me.pulldownRefresh},up:{contentdown:"上拉可以加载",contentover:"释放立即加载",contentrefresh:"正在加载...",callback:me.pullupRefresh}}}),setTimeout(function(){window.getNoteList(me)},1)},getInitialState:function(){return{notes:null}},render:function(){var me=this;if(null==this.state.notes)return React.createElement("div",null,React.createElement("div",{id:"pullrefresh",className:"mui-content mui-scroll-wrapper"},React.createElement("div",{className:"mui-scroll"},React.createElement("ul",{className:"mui-table-view"},React.createElement("li",{ref:"muiLi",className:"mui-table-view-cell listCell"},"正在加载...")))));var notes=[];return this.state.notes.forEach(function(note,index){notes.push(React.createElement(NoteRow,{note:note,afterdel1:me.getList}))}),React.createElement("div",null,React.createElement("div",{id:"pullrefresh",className:"mui-content mui-scroll-wrapper"},React.createElement("div",{className:"mui-scroll"},React.createElement("ul",{className:"mui-table-view"},notes))))}})});
//# sourceMappingURL=ListSubPage.js.map