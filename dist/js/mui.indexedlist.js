"use strict";!function($,window,document){var classSelector=function(name){return"."+$.className(name)},IndexedList=$.IndexedList=$.Class.extend({init:function(holder,options){var self=this;if(self.options=options||{},self.box=holder,!self.box)throw"实例 IndexedList 时需要指定 element";self.createDom(),self.findElements(),self.caleLayout(),self.bindEvent()},createDom:function(){var self=this;self.el=self.el||{},self.el.styleForSearch=document.createElement("style"),(document.head||document.body).appendChild(self.el.styleForSearch)},findElements:function(){var self=this;self.el=self.el||{},self.el.search=self.box.querySelector(classSelector("indexed-list-search")),self.el.searchInput=self.box.querySelector(classSelector("indexed-list-search-input")),self.el.searchClear=self.box.querySelector(classSelector("indexed-list-search")+" "+classSelector("icon-clear")),self.el.bar=self.box.querySelector(classSelector("indexed-list-bar")),self.el.barItems=[].slice.call(self.box.querySelectorAll(classSelector("indexed-list-bar")+" a")),self.el.inner=self.box.querySelector(classSelector("indexed-list-inner")),self.el.items=[].slice.call(self.box.querySelectorAll(classSelector("indexed-list-item"))),self.el.liArray=[].slice.call(self.box.querySelectorAll(classSelector("indexed-list-inner")+" li")),self.el.alert=self.box.querySelector(classSelector("indexed-list-alert"))},caleLayout:function(){var self=this,withoutSearchHeight=self.box.offsetHeight-self.el.search.offsetHeight+"px";self.el.bar.style.height=withoutSearchHeight,self.el.inner.style.height=withoutSearchHeight;var barItemHeight=(self.el.bar.offsetHeight-40)/self.el.barItems.length+"px";self.el.barItems.forEach(function(item){item.style.height=barItemHeight,item.style.lineHeight=barItemHeight})},scrollTo:function(group){var self=this,groupElement=self.el.inner.querySelector('[data-group="'+group+'"]');!groupElement||self.hiddenGroups&&self.hiddenGroups.indexOf(groupElement)>-1||(self.el.inner.scrollTop=groupElement.offsetTop)},bindBarEvent:function(){var self=this,pointElement=null,findStart=function(event){pointElement&&(pointElement.classList.remove("active"),pointElement=null),self.el.bar.classList.add("active");var point=event.changedTouches?event.changedTouches[0]:event;if(pointElement=document.elementFromPoint(point.pageX,point.pageY)){var group=pointElement.innerText;group&&1==group.length&&(pointElement.classList.add("active"),self.el.alert.innerText=group,self.el.alert.classList.add("active"),self.scrollTo(group))}event.preventDefault()},findEnd=function(event){self.el.alert.classList.remove("active"),self.el.bar.classList.remove("active"),pointElement&&(pointElement.classList.remove("active"),pointElement=null)};self.el.bar.addEventListener("touchmove",function(event){findStart(event)},!1),self.el.bar.addEventListener("touchstart",function(event){findStart(event)},!1),document.body.addEventListener("touchend",function(event){findEnd(event)},!1),document.body.addEventListener("touchcancel",function(event){findEnd(event)},!1)},search:function(keyword){var self=this;keyword=(keyword||"").toLowerCase();var selectorBuffer=[],groupIndex=-1,itemCount=0,liArray=self.el.liArray,itemTotal=liArray.length;self.hiddenGroups=[];var checkGroup=function(currentIndex,last){itemCount>=currentIndex-groupIndex-(last?0:1)&&(selectorBuffer.push(classSelector("indexed-list-inner li")+":nth-child("+(groupIndex+1)+")"),self.hiddenGroups.push(liArray[groupIndex])),groupIndex=currentIndex,itemCount=0};liArray.forEach(function(item){var currentIndex=liArray.indexOf(item);if(item.classList.contains($.className("indexed-list-group")))checkGroup(currentIndex,!1);else{var text=(item.innerText||"").toLowerCase(),value=(item.getAttribute("data-value")||"").toLowerCase(),tags=(item.getAttribute("data-tags")||"").toLowerCase();keyword&&text.indexOf(keyword)<0&&value.indexOf(keyword)<0&&tags.indexOf(keyword)<0&&(selectorBuffer.push(classSelector("indexed-list-inner li")+":nth-child("+(currentIndex+1)+")"),itemCount++),currentIndex>=itemTotal-1&&checkGroup(currentIndex,!0)}}),selectorBuffer.length>=itemTotal?self.el.inner.classList.add("empty"):selectorBuffer.length>0?(self.el.inner.classList.remove("empty"),self.el.styleForSearch.innerText=selectorBuffer.join(", ")+"{display:none;}"):(self.el.inner.classList.remove("empty"),self.el.styleForSearch.innerText="")},bindSearchEvent:function(){var self=this;self.el.searchInput.addEventListener("input",function(){var keyword=this.value;self.search(keyword)},!1),$(self.el.search).on("tap",classSelector("icon-clear"),function(){self.search("")},!1)},bindEvent:function(){var self=this;self.bindBarEvent(),self.bindSearchEvent()}});$.fn.indexedList=function(options){return this.each(function(i,element){element.indexedList||(element.indexedList=new IndexedList(element,options))}),this[0]?this[0].indexedList:null}}(mui,window,document);
//# sourceMappingURL=mui.indexedlist.js.map